---
- name: Sync Public Assets to S3
  hosts: frontend
  become: true

  vars:
    app_dir: /home/ubuntu/frontend
    aws_region: us-east-2
    s3_bucket_name: revalida-documents-891ff933

  tasks:
    - name: "ðŸ”„ INICIANDO - SincronizaÃ§Ã£o de assets para S3"
      debug:
        msg: "Sincronizando pasta public/ para s3://{{ s3_bucket_name }}/public/"

    - name: "ðŸ“¦ S3 SYNC - Sincronizando pasta public/ para S3"
      shell: |
        aws s3 sync {{ app_dir }}/public/ s3://{{ s3_bucket_name }}/public/ \
          --region {{ aws_region }} \
          --delete \
          --exclude ".git/*" \
          --exclude "*.md" \
          --cache-control "public, max-age=86400" \
          --metadata-directive REPLACE
      environment:
        AWS_REGION: "{{ aws_region }}"
      become_user: ubuntu
      register: s3_sync_result

    - name: "ðŸ“Š S3 - Mostrar resultado da sincronizaÃ§Ã£o"
      debug:
        msg:
          - "SincronizaÃ§Ã£o concluÃ­da!"
          - "Bucket: s3://{{ s3_bucket_name }}/public/"
          - "RegiÃ£o: {{ aws_region }}"

    - name: "âœ… SUCESSO - Assets sincronizados com S3!"
      debug:
        msg:
          - "ðŸŽ‰ Assets pÃºblicos atualizados no S3!"
          - "Os Ã­cones e imagens agora estÃ£o disponÃ­veis via CDN"
